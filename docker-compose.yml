version: "3.9"
services:
  rest:
    build: 
      context: .
      dockerfile: ./Taxi24.Gateways.REST/Dockerfile
    ports:
      - "8080:80"
    environment:
      ASPNETCORE_ENVIRONMENT: "Development"
    depends_on:
      - conductores
      - facturas
      - pasajeros
      - viajes
    restart: on-failure

  conductores:
    build: 
      context: .
      dockerfile: ./Taxi24.Servicios.Conductores/Dockerfile
    depends_on:
      - database
    restart: on-failure

  facturas:
    build: 
      context: .
      dockerfile: ./Taxi24.Servicios.Facturas/Dockerfile
    depends_on:
      - database
      - rabbit
    restart: on-failure

  pasajeros:
    build: 
      context: .
      dockerfile: ./Taxi24.Servicios.Pasajeros/Dockerfile
    depends_on:
      - database
    restart: on-failure

  viajes:
    build: 
      context: .
      dockerfile: ./Taxi24.Servicios.Viajes/Dockerfile
    depends_on:
      - database
      - rabbit
    restart: on-failure

  rabbit:
    image: "rabbitmq"
    restart: on-failure

  pgadmin:
    image: "dpage/pgadmin4"
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@db.com
      PGADMIN_DEFAULT_PASSWORD: admin123
    ports: 
      - "15432:80"
    depends_on: 
      - database

  database:
    image: "postgres"
    volumes:
      - data:/var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: besttaxiservice24
    restart: on-failure

volumes:
  data:
  